<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
        .hidden {
            display: none;
        }

        .main {
            background-image: url('fields.jpg');
            background-size: cover;
        }

        .navbar.navbar-expand-lg {
            background-color: #333800 !important;
        }

        .navbar-brand {
            color: #F3CFA2;
            font-weight: bold;
            font-size: 36px;
            margin-left: 1%;
        }

        .nav-link {
            color: #F3CFA2;
        }

        .form {
            background-color: rgba(24, 12, 0, 0.6);
            border-radius: 10px;
            margin-top: 10%;
            margin-bottom: 8%;
            margin-left: 20%;
            margin-right: 20%;
            padding-top: 2%;
            padding-bottom: 2%;
            padding-left: 5%;
            padding-right: 5%;
        }

        h3 {
            margin-bottom: 3%;
            color: white;
        }

        h5 {
            color: white;
        }

        table {
            width: 500px;
        }
    </style>
</head>

<body class='main'>
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">SJJ Travel</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="home.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Profile</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Dropdown
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                        </ul>
                    </li>
                </ul>
                <form class="d-flex" role="search">
                    <button class="btn btn-outline-danger" type="button" id="signoutbutton">Sign Out</button>
                </form>
            </div>
        </div>
    </nav>
    <center>
        <div class="form">
            <h3>USER PROFILE</h3>
            <div id="displayUserInfo">
                <table>
                    <tr>
                        <td>
                            <h5>Name: </h5>
                        </td>
                        <td>
                            <h5 id="displayName"></h5>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Email: </h5>
                        </td>
                        <td>
                            <h5 id="displayEmail"></h5>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Birthday: </h5>
                        </td>
                        <td>
                            <h5 id="displayBday"></h5>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Contact: </h5>
                        </td>
                        <td>
                            <h5 id="displayContact"></h5>
                        </td>
                    </tr>
                </table>
            </div>


            <div id="displayEditUserInfo" class="hidden">
                <table>
                    <tr>
                        <td>
                            <h5>First Name: </h5>
                        </td>
                        <td>
                            <input type="text" class="form-control" id="fnameInp" placeholder="First name">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Last Name: </h5>
                        </td>
                        <td>
                            <input type="text" class="form-control" id="lnameInp" placeholder="Last name">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Suffix: </h5>
                        </td>
                        <td>
                            <input type="text" class="form-control" id="suffixInp" placeholder="Suffix">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Birthday: </h5>
                        </td>
                        <td>
                            <input type="date" class="form-control" id="bdayInp" placeholder="Birthday">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h5>Contact: </h5>
                        </td>
                        <td>
                            <input type="text" class="form-control" id="contactInp" placeholder="Contact No.">
                        </td>
                    </tr>
                </table>
            </div>
            <button onclick="toggleDiv()" style="margin-top: 2%; color: white; float: center; background-color: #A44F34; border-color: #A44F34;">Edit</button>

            <button id="saveBtn" style="margin-top: 2%; color: white; float: center; background-color: #A44F34; border-color: #A44F34;" class="hidden">Save</button>
        </div>
    </center>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <script>
        let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
        let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));
        let SignoutBtn = document.getElementById('signoutbutton');
        let saveBtn = document.getElementById('saveBtn');

        let header = document.getElementById('header');

        //For user info
        let displayName = document.getElementById('displayName');
        let displayBday = document.getElementById('displayBday');
        let displayContact = document.getElementById('displayContact');

        //For edit user info
        let fname = document.getElementById('fnameInp');
        let lname = document.getElementById('lnameInp');
        let suffx = document.getElementById('suffixInp');
        let bday = document.getElementById('bdayInp');
        let contactNo = document.getElementById('contactInp');

        let Signout = () => {
            sessionStorage.removeItem("user-creds");
            sessionStorage.removeItem("user-info");
            window.location.href = 'login.html'

        }

        let CheckCred = () => {
            if (!sessionStorage.getItem("user-creds")) {
                window.location.href = 'login.html'
            } else {
                displayName.innerText = `${UserInfo.firstname + " " + UserInfo.lastname + " " + UserInfo.suffix}`;
                displayEmail.innerText = `${UserCreds.email}`;
                displayBday.innerText = `${UserInfo.birthday}`;
                displayContact.innerText = `${UserInfo.contact}`;

                fname.value = `${UserInfo.firstname}`;
                lname.value = `${UserInfo.lastname}`;
                suffx.value = `${UserInfo.suffix}`;
                bday.value = `${UserInfo.birthday}`;
                contactNo.value = `${UserInfo.contact}`;
            }
        }

        function toggleDiv() {
            var userInfo = document.getElementById("displayUserInfo");
            var editUserInfo = document.getElementById("displayEditUserInfo");
            var saveUserInfo = document.getElementById("saveBtn");
            userInfo.classList.toggle("hidden");
            editUserInfo.classList.toggle("hidden");
            saveUserInfo.classList.toggle("hidden");
        }

        window.addEventListener('load', CheckCred);
        SignoutBtn.addEventListener('click', Signout);
    </script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, get, set, ref, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAESwOq-M9TM2LTgN_BSb46EgC3TPeoM60",
            authDomain: "projectipt-69736.firebaseapp.com",
            projectId: "projectipt-69736",
            storageBucket: "projectipt-69736.appspot.com",
            messagingSenderId: "818747495180",
            appId: "1:818747495180:web:0007e493e559154d45ef29"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);

        let saveNewUserInfo = () => {
            if (fname.value === '') {
                alert("Enter First Name");
            } else if (lname.value === '') {
                alert("Enter Last Name");
            } else if (bday.value === '') {
                alert("Enter Your Birthday");
            } else if (contactNo.value === '') {
                alert("Enter Your Contact No.");
            } else {
                set(ref(db, 'UsersAuthList/' + UserInfo.uid), {
                    firstname: fname.value,
                    lastname: lname.value,
                    suffix: suffixInp.value,
                    birthday: bday.value,
                    contact: contactNo.value
                });

                sessionStorage.setItem("user-info", JSON.stringify({
                    firstname: fname.value,
                    lastname: lname.value,
                    suffix: suffixInp.value,
                    birthday: bday.value,
                    contact: contactNo.value,
                    uid: UserInfo.uid
                    
                }));
                window.location.href = 'profile.html';

            }
        }

        saveBtn.addEventListener('click', saveNewUserInfo);

    </script>
</body>

</html>
